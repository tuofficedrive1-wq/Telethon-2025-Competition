<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telethon 2025 - Live Scoreboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f0f2f5;
            background: linear-gradient(to bottom right, #ffffff, #eef2f5);
        }
        .main-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 20px;
            transition: opacity 0.5s ease-in-out;
        }
        .vs-circle {
            background: linear-gradient(135deg, #6366f1, #a855f7);
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
            border: 3px solid white;
        }
        .team-name { color: #1e293b; }
        .team-score { color: #0f172a; font-weight: 900; }
        .header-title {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .header-subtitle { color: #475569; }
        
        .winner {
            border: 3px solid #4ade80;
            box-shadow: 0 0 25px rgba(74, 222, 128, 0.5);
            background-color: #f0fdf4;
            transform: scale(1.02);
        }
        .loser {
            background-color: #f1f5f9;
            border: 3px solid transparent;
            opacity: 0.7;
        }
        .tie {
            background-color: #ffffff;
            border: 3px solid #e2e8f0;
        }
        
        .score-card, .team-container {
            transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .winner-screen-container {
            animation: fadeIn 1s ease-in-out;
            background: linear-gradient(160deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .download-btn {
            background: linear-gradient(45deg, #10b981, #3b82f6);
            transition: all 0.3s ease;
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .announcement-container {
             animation: fadeIn 0.5s ease-in-out;
        }
    </style>
</head>
<body class="text-gray-800 p-4 sm:p-6 md:p-8">

    <div id="main-content" class="main-container max-w-3xl lg:max-w-5xl xl:max-w-7xl mx-auto shadow-xl p-6 sm:p-8 lg:p-12">
        <div id="scoreboard-section">
            <div class="text-center mb-10">
                <h1 class="header-title text-5xl md:text-6xl lg:text-7xl font-black tracking-tight">TELETHON 2025</h1>
                <p class="header-subtitle text-xl md:text-2xl lg:text-3xl mt-2 font-medium">Live Scores - Semi Final Round</p>
                <div id="countdown-container" class="mt-8">
                     <h3 class="text-lg font-semibold text-gray-600 mb-3 uppercase tracking-widest">Time Remaining</h3>
                     <div id="countdown-timer"></div>
                </div>
            </div>
            <div id="status-message" class="text-center text-blue-500 text-lg my-4">
                <p>Loading scores from Google Sheet...</p>
            </div>
            <div id="scoreboard-container" class="grid grid-cols-1 gap-6 lg:gap-8"></div>
            <div class="text-center mt-10 text-gray-400 text-sm">
                <p>Jamia Tul Madina India</p>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1jlh0A1LsuShcd0MqXRbXheL77x38dZZqZj3vK2uMsO0';
        const SHEET_NAME = 'Total';
        const REFRESH_INTERVAL = 2000;
        const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

        const mainContainer = document.getElementById('main-content');
        let scoreInterval;

        async function fetchScores() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));

                if (!jsonData.table || !jsonData.table.rows) throw new Error("Invalid data format.");
                
                updateScoreboard(jsonData.table.rows);
                
                if (document.getElementById('status-message')) {
                    document.getElementById('status-message').style.display = 'none';
                }
            } catch (error) {
                console.error("Error fetching or parsing data:", error);
                if (document.getElementById('status-message')) {
                    document.getElementById('status-message').innerHTML = 'Error loading scores. Make sure the Google Sheet is public.';
                }
            }
        }

        function updateScoreboard(rows) {
            const scoreboardContainer = document.getElementById('scoreboard-container');
            if (!scoreboardContainer) return;

            const firstPositions = new Map();
            scoreboardContainer.querySelectorAll('.score-card').forEach(card => {
                firstPositions.set(card.dataset.key, card.getBoundingClientRect());
            });

            const sortedRows = rows.slice().sort((a, b) => Math.max(Number(b.c[1]?.v??0),Number(b.c[3]?.v??0)) - Math.max(Number(a.c[1]?.v??0),Number(a.c[3]?.v??0)));
            
            const fragment = document.createDocumentFragment();
            const newElements = [];
            sortedRows.forEach(row => {
                const [teamA, scoreA, teamB, scoreB] = [row.c[0]?.v??'Team A', Number(row.c[1]?.v??0), row.c[2]?.v??'Team B', Number(row.c[3]?.v??0)];
                let [teamA_class, teamB_class] = ['tie', 'tie'];
                if (scoreA > scoreB) [teamA_class, teamB_class] = ['winner', 'loser'];
                else if (scoreB > scoreA) [teamB_class, teamA_class] = ['winner', 'loser'];

                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card flex items-center justify-between space-x-4';
                scoreCard.dataset.key = `${teamA}-vs-${teamB}`;
                scoreCard.innerHTML = `
                    <div class="team-container text-center flex-1 p-4 rounded-2xl ${teamA_class}"><h2 class="team-name text-2xl md:text-3xl lg:text-4xl font-bold truncate">${teamA}</h2><p class="team-score text-5xl md:text-6xl lg:text-7xl">${scoreA}</p></div>
                    <div class="vs-circle w-12 h-12 md:w-16 md:h-16 lg:w-20 lg:h-20 rounded-full flex items-center justify-center shrink-0"><span class="text-white text-xl md:text-2xl font-bold">VS</span></div>
                    <div class="team-container text-center flex-1 p-4 rounded-2xl ${teamB_class}"><h2 class="team-name text-2xl md:text-3xl lg:text-4xl font-bold truncate">${teamB}</h2><p class="team-score text-5xl md:text-6xl lg:text-7xl">${scoreB}</p></div>`;
                fragment.appendChild(scoreCard);
                newElements.push(scoreCard);
            });
            
            scoreboardContainer.innerHTML = '';
            scoreboardContainer.appendChild(fragment);

            newElements.forEach(card => {
                const last = card.getBoundingClientRect();
                const first = firstPositions.get(card.dataset.key);
                if (first) {
                    const deltaY = first.top - last.top;
                    if (deltaY !== 0) {
                        card.style.transform = `translateY(${deltaY}px)`;
                        requestAnimationFrame(() => card.style.transform = '');
                    }
                }
            });
        }
        
        function startCountdown() {
            const countdownElement = document.getElementById('countdown-timer');
            const today = new Date();
            const countDownDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 00, 0).getTime();

            const interval = setInterval(() => {
                const distance = countDownDate - new Date().getTime();
                if (distance < 0) {
                    clearInterval(interval);
                    clearInterval(scoreInterval);
                    showWinnerAnnouncementCountdown();
                    return;
                }
                const [h, m, s] = [Math.floor((distance / (1000*60*60)) % 24), Math.floor((distance / (1000*60)) % 60), Math.floor((distance / 1000) % 60)];
                const f = n => (n<10?'0'+n:n);
                if(countdownElement) countdownElement.innerHTML = `
                     <div class="flex justify-center items-center space-x-2 md:space-x-4">
                        <div class="text-center bg-gray-100 p-3 md:p-4 rounded-lg w-28 shadow-inner"><div class="text-4xl md:text-5xl lg:text-6xl font-black text-gray-800">${f(h)}</div><div class="text-xs md:text-sm font-semibold text-gray-500 uppercase">Hours</div></div>
                        <div class="text-4xl md:text-5xl font-black text-gray-400">:</div>
                        <div class="text-center bg-gray-100 p-3 md:p-4 rounded-lg w-28 shadow-inner"><div class="text-4xl md:text-5xl lg:text-6xl font-black text-gray-800">${f(m)}</div><div class="text-xs md:text-sm font-semibold text-gray-500 uppercase">Minutes</div></div>
                        <div class="text-4xl md:text-5xl font-black text-gray-400">:</div>
                        <div class="text-center bg-gray-100 p-3 md:p-4 rounded-lg w-28 shadow-inner"><div class="text-4xl md:text-5xl lg:text-6xl font-black text-gray-800">${f(s)}</div><div class="text-xs md:text-sm font-semibold text-gray-500 uppercase">Seconds</div></div>
                    </div>`;
            }, 1000);
        }

        function showWinnerAnnouncementCountdown() {
            mainContainer.style.opacity = '0';
            setTimeout(() => {
                mainContainer.className = 'main-container max-w-3xl lg:max-w-5xl xl:max-w-7xl mx-auto shadow-xl p-6 sm:p-8 lg:p-12'; // Reset class
                mainContainer.innerHTML = `
                    <div class="announcement-container text-center flex flex-col justify-center items-center h-96">
                         <h2 class="header-subtitle text-4xl md:text-5xl font-bold mb-4">Winner Announcement</h2>
                         <div id="announcement-countdown" class="header-title text-9xl font-black">5</div>
                    </div>
                `;
                mainContainer.style.opacity = '1';
                
                let count = 5;
                const announcementCountdownElement = document.getElementById('announcement-countdown');
                const countdownInterval = setInterval(() => {
                    count--;
                    if(announcementCountdownElement) announcementCountdownElement.textContent = count;
                    if (count <= 0) {
                        clearInterval(countdownInterval);
                        displayWinners();
                    }
                }, 1000);
            }, 500);
        }

        async function displayWinners() {
            mainContainer.style.opacity = '0';
            try {
                const response = await fetch(API_URL);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));
                let allTeams = [];
                jsonData.table.rows.forEach(r => {
                    allTeams.push({ name: r.c[0]?.v??'N/A', score: Number(r.c[1]?.v??0) });
                    allTeams.push({ name: r.c[2]?.v??'N/A', score: Number(r.c[3]?.v??0) });
                });
                const top10 = allTeams.sort((a, b) => b.score - a.score).slice(0, 10);
                
                setTimeout(() => {
                    mainContainer.innerHTML = generateWinnerHtml(top10);
                    mainContainer.className = 'winner-screen-container max-w-3xl mx-auto';
                    mainContainer.style.opacity = '1';
                }, 500);
            } catch(error) {
                console.error("Failed to display winners:", error);
                mainContainer.innerHTML = `<div class="text-center text-red-500">Could not load final results.</div>`;
                mainContainer.style.opacity = '1';
            }
        }

        function generateWinnerHtml(top10) {
            const icons = {
                '1': `<svg class="w-10 h-10" viewBox="0 0 100 100"><path d="M20,2 L20,30 L50,50 L80,30 L80,2 L20,2" fill="#D22B2B"/><path d="M10,20 L30,2 L70,2 L90,20 L50,60 Z" fill="#FF4747"/><circle cx="50" cy="65" r="25" fill="#FFD700"/><circle cx="50" cy="65" r="20" fill="#FFFACD"/><text x="50" y="72" font-size="20" font-weight="bold" text-anchor="middle" fill="#B8860B">1</text></svg>`,
                '2': `<svg class="w-10 h-10" viewBox="0 0 100 100"><path d="M20,2 L20,30 L50,50 L80,30 L80,2 L20,2" fill="#007FFF"/><path d="M10,20 L30,2 L70,2 L90,20 L50,60 Z" fill="#6495ED"/><circle cx="50" cy="65" r="25" fill="#C0C0C0"/><circle cx="50" cy="65" r="20" fill="#F5F5F5"/><text x="50" y="72" font-size="20" font-weight="bold" text-anchor="middle" fill="#696969">2</text></svg>`,
                '3': `<svg class="w-10 h-10" viewBox="0 0 100 100"><path d="M20,2 L20,30 L50,50 L80,30 L80,2 L20,2" fill="#008000"/><path d="M10,20 L30,2 L70,2 L90,20 L50,60 Z" fill="#32CD32"/><circle cx="50" cy="65" r="25" fill="#CD7F32"/><circle cx="50" cy="65" r="20" fill="#F0E68C"/><text x="50" y="72" font-size="20" font-weight="bold" text-anchor="middle" fill="#8B4513">3</text></svg>`,
                'default': `<svg class="w-10 h-10" viewBox="0 0 24 24" fill="#3b82f6"><path fill-rule="evenodd" d="M12 2.25c.342 0 .66.162.853.43l3.433 5.424 6.044.878c.38.055.67.363.725.742a.75.75 0 01-.225.688l-4.373 4.261 1.033 6.02c.064.377-.142.748-.48.919a.75.75 0 01-.818-.067L12 18.497l-5.41 2.844a.75.75 0 01-.818.067.75.75 0 01-.48-.919l1.033-6.02-4.373-4.26a.75.75 0 01-.226-.688.75.75 0 01.726-.742l6.043-.878 3.433-5.424a.75.75 0 01.854-.43z" clip-rule="evenodd"/></svg>`
            };
            const sfx = i => i==1?'ST':i==2?'ND':i==3?'RD':'TH';
            const rows = top10.map((t, i) => `<div class="flex items-center p-4 md:p-5 border-b border-blue-100 last:border-b-0 ${(i%2===0)?'bg-white':'bg-blue-50'}"><div class="w-1/4 text-center text-lg md:text-xl font-bold text-indigo-600">${i+1}${sfx(i+1)}</div><div class="w-1/2 text-center text-lg md:text-xl font-semibold text-gray-800 truncate px-2">${t.name}</div><div class="w-1/4 flex justify-center">${icons[i+1]||icons.default}</div></div>`).join('');
            
            return `
                <div id="winner-poster" class="bg-transparent p-4">
                    <div class="text-center">
                        <h1 class="text-4xl md:text-5xl font-black tracking-tight" style="color: #0d47a1;">TELETHON 2025</h1>
                        <p class="text-lg md:text-xl mt-1 font-medium" style="color: #1565c0;">Friday - Semi Final Round</p>
                        <div class="relative inline-block my-6"><span class="text-red-500 text-8xl md:text-9xl font-black" style="text-shadow:3px 3px 0 #fff, 6px 6px 0 rgba(0,0,0,0.1);">10</span><span class="absolute -top-2 -right-12 md:-right-16 text-4xl md:text-5xl font-bold transform -rotate-12" style="text-shadow: 2px 2px 0 #c0a000; color: #FFD700;">TOP</span></div>
                    </div>
                    <div class="mt-6 shadow-2xl rounded-2xl overflow-hidden border-2 border-blue-200">
                        <div class="flex items-center p-4 bg-blue-600 text-white font-bold text-sm md:text-base uppercase tracking-wider rounded-t-xl"><div class="w-1/4 text-center">Rank No.</div><div class="w-1/2 text-center">Jamiatul Madina City Name</div><div class="w-1/4 text-center">Award</div></div>
                        <div>${rows}</div>
                    </div>
                    <div class="text-center mt-8 text-gray-500 font-semibold"><p>Jamia Tul Madina India</p></div>
                </div>`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchScores();
            scoreInterval = setInterval(fetchScores, REFRESH_INTERVAL);
            startCountdown();
        });
    </script>

</body>
</html>







