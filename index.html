<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telethon 2025 - Live Scoreboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fff0 0%, #d8f3dc 100%);
        }
        .main-container {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 24px;
        }
        .header-title {
            background: linear-gradient(45deg, #2d6a4f, #1b4332);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.05);
        }
        .header-subtitle { color: #40916c; }
        
        .category-box {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            transition: all 0.3s ease-in-out;
            overflow: hidden; /* Important for header design */
        }

        .category-title {
            font-family: 'Anton', sans-serif;
            font-size: 1.5rem;
            padding: 12px 20px;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-weight: 400;
            text-align: center;
            color: #ffffff;
        }

        #team-a-plus .category-title { background-color: #b7e4c7; color: #081c15;}
        #team-a .category-title { background-color: #95d5b2; color: #081c15;}
        #team-b .category-title { background-color: #74c69d; color: #081c15;}
        #team-c .category-title { background-color: #52b788; color: #ffffff;}
        #top-tier-matches .category-title { background-color: #2d6a4f; }

        .team-list-container {
            padding: 0 20px 10px 20px;
        }

        .team-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 8px;
            border-bottom: 1px solid #f3f4f6;
        }
        .team-row:last-child {
            border-bottom: none;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .vs-animated {
            font-family: 'Anton', sans-serif;
            font-weight: 400;
            font-size: 2.25rem;
            background: linear-gradient(145deg, #40916c, #2d6a4f, #1b4332);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            animation: pulse 2s infinite ease-in-out;
            display: inline-block;
            text-shadow: 1px 1px 0px #fff, 2px 3px 5px rgba(0,0,0,0.2);
        }

        @keyframes score-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-2px) scale(1.1); }
        }
        .animated-score {
            animation: score-bounce 1.5s infinite ease-in-out;
            display: inline-block;
            padding: 0 4px;
        }

        .winner-screen-container {
            animation: fadeIn 1s ease-in-out;
            background: linear-gradient(160deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .announcement-container {
             animation: fadeIn 0.5s ease-in-out;
        }
    </style>
</head>
<body class="text-gray-800 p-4 sm:p-6 md:p-8">

    <div id="main-content" class="main-container max-w-5xl mx-auto shadow-lg p-6 sm:p-8 lg:p-12">
        <div id="scoreboard-section">
            <div class="text-center mb-10">
                <h1 class="header-title text-5xl md:text-6xl font-black tracking-tight">TELETHON 2025</h1>
                <p class="header-subtitle text-xl md:text-2xl mt-2 font-medium">Live Team Categories</p>
                <div id="countdown-container" class="mt-8">
                     <h3 class="text-lg font-semibold text-gray-600 mb-3 uppercase tracking-widest">Time Remaining</h3>
                     <div id="countdown-timer"></div>
                </div>
            </div>
            <div id="status-message" class="text-center text-blue-500 text-lg my-4">
                <p>Loading scores from Google Sheet...</p>
            </div>
            
            <div id="scoreboard-container" class="space-y-8">
                 <!-- Top Tier Matches Section -->
                <div id="top-tier-matches" class="category-box hidden">
                    <h3 class="category-title">Top Matches</h3>
                    <div id="top-matches-list" class="team-list-container"></div>
                </div>

                <!-- Categories Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div id="team-a-plus" class="category-box">
                        <h3 class="category-title">Team A+</h3>
                        <div id="team-a-plus-list" class="team-list-container"></div>
                    </div>
                    <div id="team-a" class="category-box">
                        <h3 class="category-title">Team A</h3>
                        <div id="team-a-list" class="team-list-container"></div>
                    </div>
                    <div id="team-b" class="category-box">
                        <h3 class="category-title">Team B</h3>
                        <div id="team-b-list" class="team-list-container"></div>
                    </div>
                    <div id="team-c" class="category-box">
                        <h3 class="category-title">Team C</h3>
                        <div id="team-c-list" class="team-list-container"></div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-12 text-gray-400 text-sm">
                <p>Jamia Tul Madina India</p>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1jlh0A1LsuShcd0MqXRbXheL77x38dZZqZj3vK2uMsO0';
        const SHEET_NAME = 'Total';
        const REFRESH_INTERVAL = 2000;
        const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

        const mainContainer = document.getElementById('main-content');
        let scoreInterval;

        async function fetchScores() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));

                if (!jsonData.table || !jsonData.table.rows) throw new Error("Invalid data format.");
                
                updateScoreboard(jsonData.table.rows);
                
                if (document.getElementById('status-message')) {
                    document.getElementById('status-message').style.display = 'none';
                }
            } catch (error) {
                console.error("Error fetching or parsing data:", error);
                if (document.getElementById('status-message')) {
                    document.getElementById('status-message').innerHTML = 'Error loading scores. Make sure the Google Sheet is public.';
                }
            }
        }

        function updateScoreboard(rows) {
            let allTeams = [];
            rows.forEach(r => {
                if (r.c[0] && r.c[0].v) allTeams.push({ name: r.c[0].v, score: Number(r.c[1]?.v ?? 0) });
                if (r.c[2] && r.c[2].v) allTeams.push({ name: r.c[2].v, score: Number(r.c[3]?.v ?? 0) });
            });
            
            const teamAPlus = [], teamA = [], teamB = [], teamC = [], topTierTeams = [];

            allTeams.forEach(team => {
                if(team.score > 72) topTierTeams.push(team);
                else if (team.score > 50) teamAPlus.push(team);
                else if (team.score > 35) teamA.push(team);
                else if (team.score > 25) teamB.push(team);
                else teamC.push(team);
            });

            // Sort each category by score
            [teamAPlus, teamA, teamB, teamC, topTierTeams].forEach(cat => cat.sort((a,b) => b.score - a.score));

            // Render categories
            renderCategory('team-a-plus-list', teamAPlus, 'A+');
            renderCategory('team-a-list', teamA, 'A');
            renderCategory('team-b-list', teamB, 'B');
            renderCategory('team-c-list', teamC, 'C');

            // Render top tier matches
            const topTierContainer = document.getElementById('top-tier-matches');
            const topMatchesList = document.getElementById('top-matches-list');

            if (topTierTeams.length >= 2) {
                topTierContainer.classList.remove('hidden');
                let matchesHtml = '';
                for (let i = 0; i < topTierTeams.length; i += 2) {
                    if (topTierTeams[i+1]) {
                         matchesHtml += `
                            <div class="team-row text-xl flex justify-center items-center">
                                <span class="font-bold text-gray-700 w-2/5 text-right truncate">${topTierTeams[i].name} (${topTierTeams[i].score})</span>
                                <span class="w-1/5 text-center">
                                    <span class="vs-animated">VS</span>
                                </span>
                                <span class="font-bold text-gray-700 w-2/5 text-left truncate">${topTierTeams[i+1].name} (${topTierTeams[i+1].score})</span>
                            </div>
                         `;
                    } else {
                         matchesHtml += `<div class="team-row text-xl"><span class="font-bold text-gray-700">${topTierTeams[i].name} (${topTierTeams[i].score})</span> <span class="text-gray-500 ml-4">- Awaiting Opponent</span></div>`;
                    }
                }
                topMatchesList.innerHTML = matchesHtml;
            } else {
                topTierContainer.classList.add('hidden');
                topMatchesList.innerHTML = '';
            }
        }
        
        function renderCategory(containerId, teams, category) {
            const container = document.getElementById(containerId);
            if (!container) return;
            if (teams.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-400 py-6">No teams in this category</div>`;
                return;
            }
            container.innerHTML = teams.map(team => {
                let promotionText = '';
                let neededScore = 0;
                let nextCategory = '';

                if (category === 'C') {
                    neededScore = 26 - team.score;
                    nextCategory = 'Team B';
                } else if (category === 'B') {
                    neededScore = 36 - team.score;
                    nextCategory = 'Team A';
                } else if (category === 'A') {
                    neededScore = 51 - team.score;
                    nextCategory = 'Team A+';
                }

                if (nextCategory && neededScore > 0) {
                    promotionText = `
                        <span class="text-sm text-gray-500 font-medium">
                            ${nextCategory} ke liye 
                            <span class="animated-score text-green-600 font-bold">${neededScore}</span> 
                            Units aur chahiye
                        </span>`;
                }


                return `
                <div class="team-row">
                    <div>
                        <div class="font-semibold text-gray-700 truncate pr-4 text-xl">${team.name}</div>
                        ${promotionText}
                    </div>
                    <span class="font-bold text-gray-800 text-xl">${team.score} <span class="text-base font-medium text-gray-500">Units</span></span>
                </div>
            `}).join('');
        }
        
        function startCountdown() {
            const countdownElement = document.getElementById('countdown-timer');
            const today = new Date();
            const countDownDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 0, 0).getTime();

            const interval = setInterval(() => {
                const distance = countDownDate - new Date().getTime();
                if (distance < 0) {
                    clearInterval(interval);
                    clearInterval(scoreInterval);
                    showWinnerAnnouncementCountdown();
                    return;
                }
                const [h, m, s] = [Math.floor((distance / (1000*60*60)) % 24), Math.floor((distance / (1000*60)) % 60), Math.floor((distance / 1000) % 60)];
                const f = n => (n<10?'0'+n:n);
                if(countdownElement) countdownElement.innerHTML = `
                     <div class="flex justify-center items-center space-x-2 md:space-x-4">
                        <div class="text-center bg-gray-100 p-3 md:p-4 rounded-lg w-28 shadow-inner"><div class="text-4xl md:text-5xl lg:text-6xl font-black text-gray-800">${f(h)}</div><div class="text-xs md:text-sm font-semibold text-gray-500 uppercase">Hours</div></div>
                        <div class="text-4xl md:text-5xl font-black text-gray-400">:</div>
                        <div class="text-center bg-gray-100 p-3 md:p-4 rounded-lg w-28 shadow-inner"><div class="text-4xl md:text-5xl lg:text-6xl font-black text-gray-800">${f(m)}</div><div class="text-xs md:text-sm font-semibold text-gray-500 uppercase">Minutes</div></div>
                        <div class="text-4xl md:text-5xl font-black text-gray-400">:</div>
                        <div class="text-center bg-gray-100 p-3 md:p-4 rounded-lg w-28 shadow-inner"><div class="text-4xl md:text-5xl lg:text-6xl font-black text-gray-800">${f(s)}</div><div class="text-xs md:text-sm font-semibold text-gray-500 uppercase">Seconds</div></div>
                    </div>`;
            }, 1000);
        }

        function showWinnerAnnouncementCountdown() {
            mainContainer.style.opacity = '0';
            setTimeout(() => {
                mainContainer.className = 'main-container max-w-3xl lg:max-w-5xl xl:max-w-7xl mx-auto shadow-xl p-6 sm:p-8 lg:p-12';
                mainContainer.innerHTML = `
                    <div class="announcement-container text-center flex flex-col justify-center items-center h-96">
                         <h2 class="header-subtitle text-4xl md:text-5xl font-bold mb-4">Winner Announcement</h2>
                         <div id="announcement-countdown" class="header-title text-9xl font-black">5</div>
                    </div>
                `;
                mainContainer.style.opacity = '1';
                
                let count = 5;
                const announcementCountdownElement = document.getElementById('announcement-countdown');
                const countdownInterval = setInterval(() => {
                    count--;
                    if(announcementCountdownElement) announcementCountdownElement.textContent = count;
                    if (count <= 0) {
                        clearInterval(countdownInterval);
                        displayWinners();
                    }
                }, 1000);
            }, 500);
        }

        async function displayWinners() {
            mainContainer.style.opacity = '0';
            try {
                const response = await fetch(API_URL);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));
                let allTeams = [];
                jsonData.table.rows.forEach(r => {
                    if(r.c[0]?.v) allTeams.push({ name: r.c[0].v, score: Number(r.c[1]?.v??0) });
                    if(r.c[2]?.v) allTeams.push({ name: r.c[2].v, score: Number(r.c[3]?.v??0) });
                });
                const top10 = allTeams.sort((a, b) => b.score - a.score).slice(0, 10);
                
                setTimeout(() => {
                    mainContainer.innerHTML = generateWinnerHtml(top10);
                    mainContainer.className = 'winner-screen-container max-w-3xl mx-auto';
                    mainContainer.style.opacity = '1';
                }, 500);
            } catch(error) {
                console.error("Failed to display winners:", error);
                mainContainer.innerHTML = `<div class="text-center text-red-500">Could not load final results.</div>`;
                mainContainer.style.opacity = '1';
            }
        }

        function generateWinnerHtml(top10) {
            const icons = {
                '1': `<svg class="w-10 h-10" viewBox="0 0 100 100"><path d="M20,2 L20,30 L50,50 L80,30 L80,2 L20,2" fill="#D22B2B"/><path d="M10,20 L30,2 L70,2 L90,20 L50,60 Z" fill="#FF4747"/><circle cx="50" cy="65" r="25" fill="#FFD700"/><circle cx="50" cy="65" r="20" fill="#FFFACD"/><text x="50" y="72" font-size="20" font-weight="bold" text-anchor="middle" fill="#B8860B">1</text></svg>`,
                '2': `<svg class="w-10 h-10" viewBox="0 0 100 100"><path d="M20,2 L20,30 L50,50 L80,30 L80,2 L20,2" fill="#007FFF"/><path d="M10,20 L30,2 L70,2 L90,20 L50,60 Z" fill="#6495ED"/><circle cx="50" cy="65" r="25" fill="#C0C0C0"/><circle cx="50" cy="65" r="20" fill="#F5F5F5"/><text x="50" y="72" font-size="20" font-weight="bold" text-anchor="middle" fill="#696969">2</text></svg>`,
                '3': `<svg class="w-10 h-10" viewBox="0 0 100 100"><path d="M20,2 L20,30 L50,50 L80,30 L80,2 L20,2" fill="#008000"/><path d="M10,20 L30,2 L70,2 L90,20 L50,60 Z" fill="#32CD32"/><circle cx="50" cy="65" r="25" fill="#CD7F32"/><circle cx="50" cy="65" r="20" fill="#F0E68C"/><text x="50" y="72" font-size="20" font-weight="bold" text-anchor="middle" fill="#8B4513">3</text></svg>`,
                'default': `<svg class="w-10 h-10" viewBox="0 0 24 24" fill="#3b82f6"><path fill-rule="evenodd" d="M12 2.25c.342 0 .66.162.853.43l3.433 5.424 6.044.878c.38.055.67.363.725.742a.75.75 0 01-.225.688l-4.373 4.261 1.033 6.02c.064.377-.142.748-.48.919a.75.75 0 01-.818-.067L12 18.497l-5.41 2.844a.75.75 0 01-.818.067.75.75 0 01-.48-.919l1.033-6.02-4.373-4.26a.75.75 0 01-.226-.688.75.75 0 01.726-.742l6.043-.878 3.433-5.424a.75.75 0 01.854-.43z" clip-rule="evenodd"/></svg>`
            };
            const sfx = i => i==1?'ST':i==2?'ND':i==3?'RD':'TH';
            const rows = top10.map((t, i) => `<div class="flex items-center p-4 md:p-5 border-b border-blue-100 last:border-b-0 ${(i%2===0)?'bg-white':'bg-blue-50'}"><div class="w-1/4 text-center text-lg md:text-xl font-bold text-indigo-600">${i+1}${sfx(i+1)}</div><div class="w-1/2 text-center text-lg md:text-xl font-semibold text-gray-800 truncate px-2">${t.name}</div><div class="w-1/4 flex justify-center">${icons[i+1]||icons.default}</div></div>`).join('');
            
            return `
                <div id="winner-poster" class="bg-transparent p-4">
                    <div class="text-center">
                        <h1 class="text-4xl md:text-5xl font-black tracking-tight" style="color: #0d47a1;">TELETHON 2025</h1>
                        <p class="text-lg md:text-xl mt-1 font-medium" style="color: #1565c0;">Friday - Semi Final Round</p>
                        <div class="relative inline-block my-6"><span class="text-red-500 text-8xl md:text-9xl font-black" style="text-shadow:3px 3px 0 #fff, 6px 6px 0 rgba(0,0,0,0.1);">10</span><span class="absolute -top-2 -right-12 md:-right-16 text-4xl md:text-5xl font-bold transform -rotate-12" style="text-shadow: 2px 2px 0 #c0a000; color: #FFD700;">TOP</span></div>
                    </div>
                    <div class="mt-6 shadow-2xl rounded-2xl overflow-hidden border-2 border-blue-200">
                        <div class="flex items-center p-4 bg-blue-600 text-white font-bold text-sm md:text-base uppercase tracking-wider rounded-t-xl"><div class="w-1/4 text-center">Rank No.</div><div class="w-1/2 text-center">Jamiatul Madina City Name</div><div class="w-1/4 text-center">Award</div></div>
                        <div>${rows}</div>
                    </div>
                    <div class="text-center mt-8 text-gray-500 font-semibold"><p>Jamia Tul Madina India</p></div>
                </div>`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchScores();
            scoreInterval = setInterval(fetchScores, REFRESH_INTERVAL);
            startCountdown();
        });
    </script>

</body>
</html>

