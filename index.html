<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telethon 2025 Competition Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f3f4f6; /* Light gray background */
        }
        
        .card {
            transition: all 0.5s ease-in-out;
        }
        .score-value {
            transition: all 0.5s ease-in-out;
        }

        /* Highlight animation for the winning card */
        @keyframes pulse-glow {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 15px 3px rgba(22, 163, 74, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 30px 8px rgba(22, 163, 74, 0.7);
            }
        }
        .card-highlight {
            animation: pulse-glow 2s infinite ease-in-out;
            border-color: #16A34A;
        }

        .loader {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* New styles for the subtitle */
        #subtitle {
            animation: float-text 4s infinite ease-in-out;
        }
        .team-name {
            color: #374151; /* Dark gray for team names */
        }
        .vs-text {
            font-weight: 900; /* Extra bold */
            color: #FFD700; /* Gold color */
            /* 3D Gold Effect */
            text-shadow: 
                0px 1px 0px #c9a600,
                0px 2px 0px #b69300,
                0px 3px 0px #a48000,
                0px 4px 5px rgba(0, 0, 0, 0.5);
            margin: 0 0.5rem;
            display: inline-block; /* Needed for transform */
            transform: translateY(-2px); /* Lifts it slightly */
        }

        /* New floating animation for the subtitle */
        @keyframes float-text {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body class="text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-6xl font-black tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-cyan-600">
                Telethon 2025
            </h1>
            <p class="text-gray-600 mt-2 text-lg">Live Scoreboard</p>
            <!-- Animated Subtitle with 3D Gold VS -->
            <h2 id="subtitle" class="text-2xl md:text-3xl font-bold mt-4 tracking-wider">
                <span class="team-name">Academic Teachers</span>
                <span class="vs-text">VS</span>
                <span class="team-name">Qari Sahiban</span>
            </h2>
        </header>

        <!-- Dashboard Section -->
        <main id="dashboard-section">
            <!-- Score Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <!-- Team 1: Academic Teachers -->
                <div id="team-academic-teachers" class="card bg-white border-2 border-gray-200 p-8 rounded-2xl text-center flex flex-col justify-between shadow-lg">
                    <h2 class="text-3xl font-bold text-emerald-600 mb-4">Academic Teachers</h2>
                    <div>
                        <p class="text-6xl md:text-8xl font-black score-value" data-team="Academic Teachers">0.0</p>
                        <p class="text-gray-500 text-lg">Total Units</p>
                    </div>
                </div>

                <!-- Team 2: Qari Sahiban -->
                <div id="team-qari-sahiban" class="card bg-white border-2 border-gray-200 p-8 rounded-2xl text-center flex flex-col justify-between shadow-lg">
                    <h2 class="text-3xl font-bold text-cyan-600 mb-4">Qari Sahiban</h2>
                    <div>
                         <p class="text-6xl md:text-8xl font-black score-value" data-team="Qari Sahiban">0.0</p>
                         <p class="text-gray-500 text-lg">Total Units</p>
                    </div>
                </div>
            </div>

            <!-- Difference and Status -->
            <div class="bg-white p-6 rounded-2xl text-center shadow-lg">
                 <h3 class="text-2xl font-bold mb-2">Unit Difference</h3>
                 <p id="difference-value" class="text-5xl font-black text-yellow-500 mb-2">0.0</p>
                 <p id="leading-team-text" class="text-gray-600 text-lg">Abhi Muqabla Barabar Hai</p>
                 <div id="loader-container" class="mt-4 flex justify-center items-center gap-3">
                    <div class="loader"></div>
                    <span class="text-gray-600">Live data connect ho raha hai...</span>
                 </div>
                 <div id="error-message" class="text-red-500 mt-4 hidden"></div>
                 <div id="last-updated-container" class="mt-4 text-gray-500 text-sm hidden">
                    Last updated: <span id="last-updated-time"></span>
                 </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const errorMessage = document.getElementById('error-message');
            const loader = document.getElementById('loader-container');
            const lastUpdatedContainer = document.getElementById('last-updated-container');
            const lastUpdatedTime = document.getElementById('last-updated-time');

            const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT4GPTkOZ0vHaY96J6IHMsn8V7mijWFFG5pDRydvcQghiRaeVN355kQsZd81wPIG6KyvsDWG1hN_4Eq/pub?output=csv&gid=178682675';
            
            let fetchDataInterval;
            let isInitialLoad = true;

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
                loader.classList.add('hidden');
            }
            
            function hideError() {
                 errorMessage.classList.add('hidden');
            }

            async function fetchAndDisplayData(url) {
                if (isInitialLoad) {
                    loader.classList.remove('hidden');
                }
                hideError();

                try {
                    const urlWithCacheBust = url + '&_=' + new Date().getTime();
                    const response = await fetch(urlWithCacheBust);
                    if (!response.ok) throw new Error(`Network response was not ok. Status: ${response.status}`);
                    
                    const csvData = await response.text();
                    const scores = parseCSV(csvData);
                    updateDashboard(scores);
                    
                    if (isInitialLoad) {
                        loader.classList.add('hidden');
                        lastUpdatedContainer.classList.remove('hidden');
                        isInitialLoad = false;
                    }
                    lastUpdatedTime.textContent = new Date().toLocaleTimeString();

                } catch (error) {
                    console.error('Fetching error:', error);
                    showError('Data fetch nahi ho saka. Sheet ko "Publish to web" zaroor karein aur check karein ki woh public hai.');
                    if (fetchDataInterval) clearInterval(fetchDataInterval);
                }
            }

            function parseCSV(csv) {
                const lines = csv.split('\n').slice(1);
                const scores = {
                    'Academic Teachers': 0,
                    'Qari Sahiban': 0,
                };

                lines.forEach(line => {
                    const row = line.split(',');
                    if (row && row.length >= 2) { 
                        const team = (row[0] || '').trim().replace(/"/g, '');
                        const units = parseFloat((row[1] || '0').trim());

                        if (!isNaN(units)) {
                            // Using direct assignment instead of accumulation for robustness
                            if (team.toLowerCase().includes('academic')) {
                                scores['Academic Teachers'] = units;
                            } else if (team.toLowerCase().includes('qari')) {
                                scores['Qari Sahiban'] = units;
                            }
                        }
                    }
                });
                return scores;
            }

            function updateDashboard(scores) {
                const team1Units = scores['Academic Teachers'];
                const team2Units = scores['Qari Sahiban'];
                const difference = Math.abs(team1Units - team2Units);

                const team1Card = document.getElementById('team-academic-teachers');
                const team2Card = document.getElementById('team-qari-sahiban');
                const team1ScoreEl = document.querySelector('[data-team="Academic Teachers"]');
                const team2ScoreEl = document.querySelector('[data-team="Qari Sahiban"]');
                const differenceEl = document.getElementById('difference-value');
                const leadingTextEl = document.getElementById('leading-team-text');
                
                animateValue(team1ScoreEl, parseFloat(team1ScoreEl.innerText.replace(/,/g, '')) || 0, team1Units, 500, true);
                animateValue(team2ScoreEl, parseFloat(team2ScoreEl.innerText.replace(/,/g, '')) || 0, team2Units, 500, true);
                animateValue(differenceEl, parseFloat(differenceEl.innerText.replace(/,/g, '')) || 0, difference, 500, true);

                team1Card.classList.remove('card-highlight');
                team2Card.classList.remove('card-highlight');

                if (team1Units > team2Units) {
                    team1Card.classList.add('card-highlight');
                    leadingTextEl.innerText = 'Academic Teachers Aage Hain!';
                } else if (team2Units > team1Units) {
                    team2Card.classList.add('card-highlight');
                    leadingTextEl.innerText = 'Qari Sahiban Aage Hain!';
                } else {
                    leadingTextEl.innerText = 'Abhi Muqabla Barabar Hai';
                }
            }
            
            function animateValue(element, start, end, duration, isFloat = false) {
                if (start === end && (isFloat ? parseFloat(element.innerText) === end : parseInt(element.innerText.replace(/,/g, '')) === end)) return;
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const currentValue = progress * (end - start) + start;
                    element.innerText = isFloat ? currentValue.toFixed(1) : Math.floor(currentValue).toLocaleString();
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    } else {
                        element.innerText = isFloat ? end.toFixed(1) : end.toLocaleString();
                    }
                };
                window.requestAnimationFrame(step);
            }

            fetchAndDisplayData(sheetUrl);
            // Changed interval back to 5 seconds (5000ms) as requested
            fetchDataInterval = setInterval(() => fetchAndDisplayData(sheetUrl), 5000);
        });
    </script>
</body>
</html>

