<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telethon 2025 - Live Scoreboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fff0 0%, #d8f3dc 100%);
            transition: background 0.8s ease-in-out;
        }
        .main-container {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 24px;
            transition: opacity 0.5s ease-in-out;
        }
        .header-title {
            background: linear-gradient(45deg, #2d6a4f, #1b4332);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.05);
        }
        
        .animated-subtitle {
            font-weight: 700;
            background: linear-gradient(90deg, #2d6a4f, #b7e4c7, #2d6a4f);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            animation: shimmer 4s linear infinite;
        }

        @keyframes shimmer {
            to {
                background-position: -200% center;
            }
        }
        
        .category-box {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            transition: all 0.3s ease-in-out;
            overflow: hidden; /* Important for header design */
        }

        .category-title {
            font-family: 'Anton', sans-serif;
            font-size: 1.5rem;
            padding: 12px 20px;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-weight: 400;
            text-align: center;
            color: #ffffff;
        }

        #team-a-plus .category-title { background-color: #b7e4c7; color: #081c15;}
        #team-a .category-title { background-color: #95d5b2; color: #081c15;}
        #team-b .category-title { background-color: #74c69d; color: #081c15;}
        #team-c .category-title { background-color: #52b788; color: #ffffff;}
        #top-tier-matches .category-title { background-color: #2d6a4f; }

        .team-list-container {
            padding: 0 20px 10px 20px;
        }

        .team-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 8px;
            border-bottom: 1px solid #f3f4f6;
        }
        .team-row:last-child {
            border-bottom: none;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .vs-animated {
            font-family: 'Anton', sans-serif;
            font-weight: 400;
            font-size: 2.25rem;
            background: linear-gradient(145deg, #40916c, #2d6a4f, #1b4332);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            animation: pulse 2s infinite ease-in-out;
            display: inline-block;
            text-shadow: 1px 1px 0px #fff, 2px 3px 5px rgba(0,0,0,0.2);
        }

        @keyframes score-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-2px) scale(1.1); }
        }
        .animated-score {
            animation: score-bounce 1.5s infinite ease-in-out;
            display: inline-block;
            padding: 0 4px;
        }

        @keyframes newEntryFlash {
          0% { background-color: #d1fae5; transform: translateX(-10px); }
          50% { background-color: #d1fae5; transform: translateX(0); }
          100% { background-color: transparent; }
        }
        .new-entry {
          animation: newEntryFlash 2.5s ease-out;
        }

        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1b4332 0%, #2d6a4f 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 9999;
            animation: fadeIn 1s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes reveal {
            0% { transform: translateY(50px) scale(0.8); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        .winner-reveal {
            animation: reveal 1.5s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .region-match-box {
            background: linear-gradient(135deg, #ffffff, #f0f7ff);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            animation: zoomIn 0.8s ease-in-out;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 2rem;
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .vs-animated-region {
            font-family: 'Anton', sans-serif;
            font-weight: 400;
            font-size: 3rem;
            background: linear-gradient(45deg, #ff8c00, #ff0080, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            animation: pulse 1.5s infinite ease-in-out, rainbow-text 5s infinite linear;
            display: inline-block;
            background-size: 200% 200%;
        }

        @keyframes rainbow-text {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

    </style>
</head>
<body class="text-gray-800 p-4 sm:p-6 md:p-8">

    <div id="main-content" class="main-container max-w-7xl mx-auto shadow-lg p-6 sm:p-8 lg:p-12">
        <!-- This content will be replaced dynamically -->
    </div>
    
    <div id="fullscreen-container"></div>

    <script>
        const SHEET_ID = '1jlh0A1LsuShcd0MqXRbXheL77x38dZZqZj3vK2uMsO0';
        const SHEET_NAME = 'Total';
        const REFRESH_INTERVAL = 2000;
        const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

        const mainContainer = document.getElementById('main-content');
        const fullscreenContainer = document.getElementById('fullscreen-container');
        let scoreInterval;
        let previousTeamState = {};

        function showInitialDashboard() {
            mainContainer.innerHTML = `
                <div id="scoreboard-section">
                    <div class="text-center mb-10">
                        <h1 class="header-title text-5xl md:text-6xl font-black tracking-tight">TELETHON 2025</h1>
                        <p class="animated-subtitle text-2xl md:text-3xl mt-4">üèÜ GRAND FINAL MUQABLA üèÜ</p>
                        <div id="countdown-container" class="mt-6">
                             <div id="countdown-timer"></div>
                        </div>
                    </div>
                    <div id="status-message" class="text-center text-blue-500 text-lg my-4">
                        <p>Loading scores from Google Sheet...</p>
                    </div>
                    <div id="scoreboard-container" class="space-y-8">
                         <div id="top-tier-matches" class="category-box hidden">
                            <h3 class="category-title">Top Matches</h3>
                            <div id="top-matches-list" class="team-list-container"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div id="team-a-plus" class="category-box"><h3 class="category-title">Team A+</h3><div id="team-a-plus-list" class="team-list-container"></div></div>
                            <div id="team-a" class="category-box"><h3 class="category-title">Team A</h3><div id="team-a-list" class="team-list-container"></div></div>
                            <div id="team-b" class="category-box"><h3 class="category-title">Team B</h3><div id="team-b-list" class="team-list-container"></div></div>
                            <div id="team-c" class="category-box"><h3 class="category-title">Team C</h3><div id="team-c-list" class="team-list-container"></div></div>
                        </div>
                    </div>
                    <div class="text-center mt-12 text-gray-400 text-sm"><p>Jamia Tul Madina India</p></div>
                </div>`;
        }
        
        async function fetchScores() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));
                if (!jsonData.table || !jsonData.table.rows) throw new Error("Invalid data format.");
                updateScoreboard(jsonData.table.rows);
                if (document.getElementById('status-message')) {
                    document.getElementById('status-message').style.display = 'none';
                }
            } catch (error) {
                console.error("Error fetching or parsing data:", error);
                if (document.getElementById('status-message')) {
                    document.getElementById('status-message').innerHTML = 'Error loading scores. Make sure the Google Sheet is public.';
                }
            }
        }

        function updateScoreboard(rows) {
            let allTeams = [];
            rows.forEach(r => {
                if (r.c[1] && r.c[1].v) {
                    allTeams.push({ name: r.c[1].v, score: Number(r.c[2]?.v ?? 0) });
                }
            });
            
            const teamAPlus = [], teamA = [], teamB = [], teamC = [];
            const currentTeamState = {};

            allTeams.forEach(team => {
                if(team.score > 71) { teamAPlus.push(team); currentTeamState[team.name] = 'A+'; } 
                else if (team.score >= 50) { teamA.push(team); currentTeamState[team.name] = 'A'; } 
                else if (team.score >= 35) { teamB.push(team); currentTeamState[team.name] = 'B'; } 
                else if (team.score >= 25) { teamC.push(team); currentTeamState[team.name] = 'C'; }
            });

            [teamAPlus, teamA, teamB, teamC].forEach(cat => cat.sort((a,b) => b.score - a.score));
            
            renderCategory('team-a-plus-list', teamAPlus, 'A+');
            renderCategory('team-a-list', teamA, 'A');
            renderCategory('team-b-list', teamB, 'B');
            renderCategory('team-c-list', teamC, 'C');

            const topTierContainer = document.getElementById('top-tier-matches');
            const topMatchesList = document.getElementById('top-matches-list');

            if (teamAPlus.length > 0) {
                topTierContainer.classList.remove('hidden');
                let matchesHtml = '';
                for (let i = 0; i < teamAPlus.length; i += 2) {
                    if (teamAPlus[i+1]) {
                         matchesHtml += `<div class="team-row text-xl flex justify-center items-center"><span class="font-bold text-gray-700 w-2/5 text-right truncate">${teamAPlus[i].name} (${teamAPlus[i].score})</span><span class="w-1/5 text-center"><span class="vs-animated">VS</span></span><span class="font-bold text-gray-700 w-2/5 text-left truncate">${teamAPlus[i+1].name} (${teamAPlus[i+1].score})</span></div>`;
                    } else {
                         matchesHtml += `<div class="team-row text-xl flex justify-center items-center"><span class="font-bold text-gray-700">${teamAPlus[i].name} (${teamAPlus[i].score})</span> <span class="text-gray-500 ml-4">- Muqabil Ka Intizar Hai.</span></div>`;
                    }
                }
                topMatchesList.innerHTML = matchesHtml;
            } else {
                if(topTierContainer) topTierContainer.classList.add('hidden');
                if(topMatchesList) topMatchesList.innerHTML = '';
            }
            
            previousTeamState = currentTeamState;
        }
        
        function renderCategory(containerId, teams, category) {
            const container = document.getElementById(containerId);
            if (!container) return;
            if (teams.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-400 py-6">No teams in this category</div>`;
                return;
            }
            container.innerHTML = teams.map(team => {
                const isNewEntry = previousTeamState[team.name] && previousTeamState[team.name] !== category;
                const entryClass = isNewEntry ? 'new-entry' : '';
                let neededScore = 0;
                if (category === 'C') neededScore = 35 - team.score;
                else if (category === 'B') neededScore = 50 - team.score;
                else if (category === 'A') neededScore = 72 - team.score;
                
                let promotionText = neededScore > 0 ? `<span class="text-sm text-green-600 font-medium flex items-center"><svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg><span class="animated-score font-bold">${neededScore}</span></span>` : '';
                
                if (category === 'A+') promotionText = '';

                return `<div class="team-row ${entryClass}"><div><div class="font-semibold text-gray-700 truncate pr-4 text-xl">${team.name}</div>${promotionText}</div><span class="font-bold text-gray-800 text-xl">${team.score}</span></div>`;
            }).join('');
        }
        
        function startCountdown() {
            const countdownElement = document.getElementById('countdown-timer');
            const today = new Date();
            const countDownDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 30, 0).getTime();
            const interval = setInterval(() => {
                const distance = countDownDate - new Date().getTime();
                if (distance < 0) {
                    clearInterval(interval);
                    if(scoreInterval) clearInterval(scoreInterval);
                    startFinalCountdown();
                    return;
                }
                const [h, m, s] = [Math.floor((distance / (36e5))), Math.floor((distance / 6e4) % 60), Math.floor((distance / 1000) % 60)];
                const f = n => (n<10?'0'+n:n);
                if(countdownElement) countdownElement.innerHTML = `<div class="flex justify-center items-center space-x-2"><div class="text-center bg-gray-100 p-3 rounded-lg w-24 shadow-inner"><div class="text-3xl md:text-4xl font-black text-gray-800">${f(h)}</div><div class="text-xs font-semibold text-gray-500 uppercase">Hours</div></div><div class="text-3xl font-black text-gray-400">:</div><div class="text-center bg-gray-100 p-3 rounded-lg w-24 shadow-inner"><div class="text-3xl md:text-4xl font-black text-gray-800">${f(m)}</div><div class="text-xs font-semibold text-gray-500 uppercase">Minutes</div></div><div class="text-3xl font-black text-gray-400">:</div><div class="text-center bg-gray-100 p-3 rounded-lg w-24 shadow-inner"><div class="text-3xl md:text-4xl font-black text-gray-800">${f(s)}</div><div class="text-xs font-semibold text-gray-500 uppercase">Seconds</div></div></div>`;
            }, 1000);
        }

        function startFinalCountdown() {
            mainContainer.style.display = 'none';
            let seconds = 60;
            fullscreenContainer.innerHTML = `<div class="fullscreen-overlay"><h2 class="text-4xl font-bold uppercase tracking-widest mb-8">Final Countdown</h2><div id="final-countdown-timer" class="text-9xl font-black">${seconds}</div></div>`;
            const timerElement = document.getElementById('final-countdown-timer');
            const finalInterval = setInterval(() => {
                seconds--;
                if(timerElement) timerElement.textContent = seconds;
                if (seconds <= 0) {
                    clearInterval(finalInterval);
                    announceWinnersSequentially();
                }
            }, 1000);
        }

        async function announceWinnersSequentially() {
            try {
                const response = await fetch(API_URL);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));
                let allTeams = [];
                jsonData.table.rows.forEach(r => { if(r.c[1]?.v) allTeams.push({ name: r.c[1].v, score: Number(r.c[2]?.v??0) }); });
                const top3 = allTeams.sort((a, b) => b.score - a.score).slice(0, 3);
                
                setTimeout(() => showWinner(top3[2], '3rd Place', '#cd7f32'), 1000);
                setTimeout(() => showWinner(top3[1], '2nd Place', '#c0c0c0'), 6000);
                setTimeout(() => showWinner(top3[0], '1st Place', '#ffd700'), 11000);
                setTimeout(() => startRegionMatches(), 18000); 

            } catch(error) {
                console.error("Failed to display winners:", error);
                fullscreenContainer.innerHTML = `<div class="fullscreen-overlay"><div class="text-center text-red-300">Could not load final results.</div></div>`;
            }
        }
        
        function showWinner(team, rank, color) {
            const isFirstPlace = rank === '1st Place';
            fullscreenContainer.innerHTML = `<div class="fullscreen-overlay"><div class="text-center winner-reveal"><h2 class="text-3xl md:text-4xl font-semibold opacity-80 mb-4">Telethon 2025 Grand Final Winner</h2><div class="text-6xl md:text-8xl font-black uppercase tracking-wider" style="color: ${color}; text-shadow: 0 0 20px ${color}, 0 0 30px rgba(255,255,255,0.5);">${rank}</div><div class="text-5xl md:text-7xl font-bold my-6">${team.name}</div><div class="text-4xl md:text-6xl font-semibold bg-white/20 px-6 py-2 rounded-xl inline-block">${team.score}</div>${isFirstPlace ? '<div class="text-4xl mt-8">üéâ CONGRATULATIONS! üéâ</div>' : ''}</div></div>`;
        }

        function startRegionMatches() {
            fullscreenContainer.innerHTML = '';
            document.body.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
            mainContainer.style.display = 'block';
            mainContainer.style.opacity = '0';
            mainContainer.classList.remove('max-w-7xl');
            mainContainer.classList.add('max-w-5xl');

            mainContainer.innerHTML = `
                <div id="region-scoreboard-section">
                    <div class="text-center mb-10">
                        <h1 class="header-title text-5xl md:text-6xl font-black tracking-tight" style="background: linear-gradient(45deg, #ecf0f1, #bdc3c7); -webkit-background-clip: text;">TELETHON 2025</h1>
                        <p class="animated-subtitle text-2xl md:text-3xl mt-4" style="background: linear-gradient(90deg, #ecf0f1, #95a5a6, #ecf0f1); background-size: 200% auto; -webkit-background-clip: text;">üèÜ REGION WISE MUQABLA üèÜ</p>
                         <div id="region-countdown-container" class="mt-6"></div>
                    </div>
                    <div id="status-message-region" class="text-center text-gray-300 text-lg my-4"><p>Loading region scores...</p></div>
                    <div id="region-scoreboard-container" class="space-y-8">
                        <div class="region-match-box">
                             <div class="flex justify-center items-center">
                                <div id="delhi-name" class="font-bold text-gray-800 w-2/5 text-right truncate text-3xl">Delhi Region</div>
                                <div class="w-1/5 text-center"><span class="vs-animated-region">VS</span></div>
                                <div id="ajmer-name" class="font-bold text-gray-800 w-2/5 text-left truncate text-3xl">Ajmer Region</div>
                             </div>
                             <div class="flex justify-center items-center pt-4">
                                <div id="delhi-score" class="font-black text-6xl text-gray-800 w-2/5 text-right">0</div>
                                <div class="w-1/5 text-center"></div>
                                <div id="ajmer-score" class="font-black text-6xl text-gray-800 w-2/5 text-left">0</div>
                             </div>
                        </div>
                        <div class="region-match-box">
                            <div class="flex justify-center items-center">
                                <div id="mumbai-name" class="font-bold text-gray-800 w-2/5 text-right truncate text-3xl">Mumbai Region</div>
                                <div class="w-1/5 text-center"><span class="vs-animated-region">VS</span></div>
                                <div id="multi-name" class="font-bold text-gray-800 w-2/5 text-left truncate text-3xl">Hyd+Bang+Kol</div>
                            </div>
                            <div class="flex justify-center items-center pt-4">
                                <div id="mumbai-score" class="font-black text-6xl text-gray-800 w-2/5 text-right">0</div>
                                <div class="w-1/5 text-center"></div>
                                <div id="multi-score" class="font-black text-6xl text-gray-800 w-2/5 text-left">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-12 text-gray-400 text-sm"><p>Jamia Tul Madina India</p></div>
                </div>`;

            setTimeout(() => {
                mainContainer.style.opacity = '1';
                fetchRegionScores();
                scoreInterval = setInterval(fetchRegionScores, REFRESH_INTERVAL);
                startRegionCountdown();
            }, 500);
        }
        
        function startRegionCountdown() {
            const countdownElement = document.getElementById('region-countdown-container');
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const countDownDate = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 0, 35, 0).getTime();
            
            const interval = setInterval(() => {
                const distance = countDownDate - new Date().getTime();
                if (distance < 0) {
                    clearInterval(interval);
                    if (scoreInterval) clearInterval(scoreInterval);
                    if(countdownElement) countdownElement.innerHTML = `<div class="text-2xl font-bold text-gray-200">Muqabla Khatm Hua! Winners ka elaan 12:15 AM par hoga.</div>`;
                    
                    const announceTime = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 0, 36, 0).getTime();
                    const delay = announceTime - new Date().getTime();
                    setTimeout(announceRegionWinners, Math.max(0, delay));
                    return;
                }
                const [h, m, s] = [Math.floor((distance / (36e5))), Math.floor((distance / 6e4) % 60), Math.floor((distance / 1000) % 60)];
                const f = n => (n < 10 ? '0' + n : n);
                if (countdownElement) countdownElement.innerHTML = `<div class="flex justify-center items-center space-x-2"><div class="text-center bg-gray-700/50 p-3 rounded-lg w-24 shadow-inner"><div class="text-3xl md:text-4xl font-black text-white">${f(h)}</div><div class="text-xs font-semibold text-gray-300 uppercase">Hours</div></div><div class="text-3xl font-black text-gray-400">:</div><div class="text-center bg-gray-700/50 p-3 rounded-lg w-24 shadow-inner"><div class="text-3xl md:text-4xl font-black text-white">${f(m)}</div><div class="text-xs font-semibold text-gray-300 uppercase">Minutes</div></div><div class="text-3xl font-black text-gray-400">:</div><div class="text-center bg-gray-700/50 p-3 rounded-lg w-24 shadow-inner"><div class="text-3xl md:text-4xl font-black text-white">${f(s)}</div><div class="text-xs font-semibold text-gray-300 uppercase">Seconds</div></div></div>`;
            }, 1000);
        }
        
        async function announceRegionWinners() {
            mainContainer.style.display = 'none';
             try {
                const response = await fetch(API_URL);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));
                let scores = { delhi: 0, ajmer: 0, mumbai: 0, multi: 0 };
                jsonData.table.rows.forEach(r => {
                    const region = r.c[0]?.v ? r.c[0].v.trim() : null;
                    const unit = !isNaN(parseFloat(r.c[2]?.v)) ? parseFloat(r.c[2].v) : 0;
                    if (region === 'Delhi Region') scores.delhi += unit;
                    else if (region === 'Ajmer Region') scores.ajmer += unit;
                    else if (region === 'Mumbai Region') scores.mumbai += unit;
                    else if (['Hyderabad Region', 'Bangalore Region', 'Kolkata Region'].includes(region)) scores.multi += unit;
                });

                const match1Winner = scores.delhi > scores.ajmer ? {name: 'Delhi Region', score: scores.delhi} : {name: 'Ajmer Region', score: scores.ajmer};
                const match2Winner = scores.mumbai > scores.multi ? {name: 'Mumbai Region', score: scores.mumbai} : {name: 'Hyd+Bang+Kol', score: scores.multi};
                
                setTimeout(() => showRegionWinner(match1Winner, "Match 1 Winner"), 1000);
                setTimeout(() => showRegionWinner(match2Winner, "Match 2 Winner"), 6000);
                
            } catch(error) {
                console.error("Failed to display region winners:", error);
                fullscreenContainer.innerHTML = `<div class="fullscreen-overlay"><div class="text-center text-red-300">Could not load region results.</div></div>`;
            }
        }
        
        function showRegionWinner(winner, title) {
             fullscreenContainer.innerHTML = `<div class="fullscreen-overlay" style="background: linear-gradient(135deg, #000428 0%, #004e92 100%);"><div class="text-center winner-reveal"><h2 class="text-5xl md:text-6xl font-black uppercase tracking-wider text-yellow-400" style="text-shadow: 0 0 15px #fef08a;">${title}</h2><div class="text-5xl md:text-7xl font-bold my-8">${winner.name}</div><div class="text-4xl md:text-6xl font-semibold bg-white/20 px-6 py-2 rounded-xl inline-block">${winner.score}</div><div class="text-4xl mt-8">üéâ CONGRATULATIONS! üéâ</div></div></div>`;
        }

        async function fetchRegionScores() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47).slice(0, -2));
                if (!jsonData.table || !jsonData.table.rows) throw new Error("Invalid data format.");
                
                let scores = { delhi: 0, ajmer: 0, mumbai: 0, multi: 0 };
                jsonData.table.rows.forEach(r => {
                    const region = r.c[0]?.v ? r.c[0].v.trim() : null;
                    const unitValue = r.c[2]?.v;
                    const unit = !isNaN(parseFloat(unitValue)) ? parseFloat(unitValue) : 0;

                    if (region === 'Delhi Region') scores.delhi += unit;
                    else if (region === 'Ajmer Region') scores.ajmer += unit;
                    else if (region === 'Mumbai Region') scores.mumbai += unit;
                    else if (['Hyderabad Region', 'Bangalore Region', 'Kolkata Region'].includes(region)) scores.multi += unit;
                });
                updateRegionScoreboard(scores);
                const statusMsg = document.getElementById('status-message-region');
                if(statusMsg) statusMsg.style.display = 'none';
            } catch (error) {
                console.error("Error fetching region data:", error);
                const statusMsg = document.getElementById('status-message-region');
                if(statusMsg) statusMsg.innerHTML = 'Error loading region scores.';
            }
        }

        function updateRegionScoreboard({delhi, ajmer, mumbai, multi}) {
            document.getElementById('delhi-score').textContent = delhi;
            document.getElementById('ajmer-score').textContent = ajmer;
            document.getElementById('mumbai-score').textContent = mumbai;
            document.getElementById('multi-score').textContent = multi;
            document.getElementById('multi-name').textContent = 'Hyd+Bang+Kol';

            const highlight = (scoreElem1, scoreElem2, nameElem1, nameElem2, score1, score2) => {
                if (!nameElem1 || !nameElem2 || !scoreElem1 || !scoreElem2) return;
                
                nameElem1.style.color = score1 > score2 ? '#10b981' : (score1 < score2 ? '#71717a' : '#1f2937');
                scoreElem1.style.color = score1 > score2 ? '#10b981' : (score1 < score2 ? '#71717a' : '#1f2937');

                nameElem2.style.color = score2 > score1 ? '#10b981' : (score2 < score1 ? '#71717a' : '#1f2937');
                scoreElem2.style.color = score2 > score1 ? '#10b981' : (score2 < score1 ? '#71717a' : '#1f2937');
            };
            
            highlight(
                document.getElementById('delhi-score'), 
                document.getElementById('ajmer-score'),
                document.getElementById('delhi-name'),
                document.getElementById('ajmer-name'),
                delhi, 
                ajmer
            );
            highlight(
                document.getElementById('mumbai-score'),
                document.getElementById('multi-score'),
                document.getElementById('mumbai-name'),
                document.getElementById('multi-name'),
                mumbai,
                multi
            );
        }

        document.addEventListener('DOMContentLoaded', () => {
            showInitialDashboard();
            fetchScores();
            scoreInterval = setInterval(fetchScores, REFRESH_INTERVAL);
            startCountdown();
        });
    </script>

</body>
</html>




